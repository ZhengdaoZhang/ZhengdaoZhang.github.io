<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./assets/logo.png" type="image/png">
    <title>Photography Album</title>
    <script src="./js/vue.global.js"></script>
    <script src="./js/viewer.min.js"></script>
    <link rel="stylesheet" href="./css/viewer.min.css">
    <link rel="stylesheet" href="./css/styles.css">
</head>

<body>

    <div id="app">

    </div>
    <script type="module">
        const { createApp, ref, computed, watch } = Vue;
        import { PHOTO_BASE_URL, TYPE_LIST, PHOTO_URL_LIST } from './js/constants.js'
        const app = createApp({
            template: `
            <header>
                <img src="./assets/logo.png" alt="magee avatar" id="logo">
                <h1 id="website-title">Photography Album</h1>
                <!-- <div id="search-bar">
                    <label for="type-select">
                        <span>photo types: </span>
                        <select v-model="type" id="type-select">
                            <option v-for="({value,label}) of typeList" :key="value" :value="value">{{label}}</option>
                        </select>
                    </label>
                </div> -->
                <i id="menu-btn" @click="switchMenu"></i>
            </header>
            <div id="menu" :class="menuSwitch?'act':''" @click="switchMenu">

                <ul class="menu-list">
                    <li class="menu-item" v-for="({value,label}) of typeList" @click.stop="menuItemClick(value)">
                        <h2 class="name">{{label}}</h2>
                        <i class="append"></i>
                    </li>
                </ul>
            </div>
            <main >
                <h2 id="title">{{typeTitle}} photos</h2>
                <ul id="photo-list" ref="photoListEl">
                    <li v-for="(item,index) of photoList" :key="index" class="photo-item">
                        <img :origin-src="getFullImageUrl(1,item.url)" :src="getFullImageUrl(0,item.url)" :alt="item.title"
                            loading="lazy" @click="lookBigPhoto($event,index)">
                        <p>{{item.title}}</p>
                    </li>
                </ul>
            </main>
            <footer>
                <p>made by ZhengdaoZhang</p>
            </footer>
            `,
            setup() {
                let viewer = null;
                const menuSwitch = ref(false);
                const photoListEl = ref(null);
                const mainEl = ref(null);
                const typeList = TYPE_LIST;
                const type = ref(0);
                const photoList = ref([]);
                const typeTitle = computed(() => {
                    return typeList.find(item => item.value === type.value).label
                })
                watch(type, (v) => {
                    document.getElementById("app").scrollTo({
                        top: 0
                    })
                    photoList.value = PHOTO_URL_LIST.filter(item => type.value === 0 ? true : type.value === item.type);
                    if (viewer) {
                        viewer.update();
                    }
                }, {
                    immediate: true
                });

                function switchMenu() {
                    menuSwitch.value = !menuSwitch.value;
                }
                function menuItemClick(typeVal) {
                    switchMenu();
                    type.value = typeVal;
                }
                function getFullImageUrl(type, url) {
                    return PHOTO_BASE_URL + (type === 0 ? "thumbnail/" : "full/") + url
                }
                function lookBigPhoto(event, photoIndex) {
                    if (!viewer) {
                        viewer = new Viewer(photoListEl.value, {
                            toolbar: false,
                            navbar: false,
                            url(image) {
                                return image.getAttribute("origin-src")
                            }
                        });
                        viewer.show();
                    } else {
                        viewer.show();
                    }
                }
                return {
                    menuSwitch,
                    photoListEl,
                    mainEl,
                    typeList,
                    type,
                    typeTitle,
                    photoList,
                    switchMenu,
                    menuItemClick,
                    getFullImageUrl,
                    lookBigPhoto
                }
            }
        })
        app.mount("#app");
    </script>
</body>

</html>